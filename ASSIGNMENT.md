# Backend Developer Assignment

---

## üá∫üá¶ –û–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è (Original)

### –ö–æ–Ω—Ç–µ–∫—Å—Ç

–í–∏ —Ä–æ–∑—Ä–æ–±–ª—è—î—Ç–µ backend –¥–ª—è SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏, —è–∫–∞ –ø—Ä–æ–¥–∞—î –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è.  
–°–∏—Å—Ç–µ–º–∞ –º–∞—î –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ä—ñ–∑–Ω—ñ –º–æ–¥–µ–ª—ñ —Ç–∞—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –±–∞–∑–æ–≤—É —Å–∏—Å—Ç–µ–º—É –∑–Ω–∏–∂–æ–∫.

### –¢–µ—Ö–Ω—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏

- NestJS
- PostgreSQL
- ORM (Prisma / TypeORM)
- REST Architecture

### –ë—ñ–∑–Ω–µ—Å-–≤–∏–º–æ–≥–∏

| –ü–ª–∞–Ω | Base Price | Price per Seat | –í–∫–ª—é—á–µ–Ω–æ API calls |
| --- | --- | --- | --- |
| Starter | $29.99/–º—ñ—Å | ‚Äî | 1,000 |
| Professional | $99.49/–º—ñ—Å | $15.75/user | 10,000 |
| Enterprise | $299.90/–º—ñ—Å | $12.30/user | 100,000 |

### –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∏–∂–æ–∫

| –¢–∏–ø –∑–Ω–∏–∂–∫–∏ | –£–º–æ–≤–∞ | –†–æ–∑–º—ñ—Ä |
| --- | --- | --- |
| –ü—Ä–æ–º–æ–∫–æ–¥ | –í–∞–ª—ñ–¥–Ω–∏–π –∫–æ–¥ | –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —Å—É–º–∞ –∞–±–æ % |
| –†—ñ—á–Ω–∞ –ø—ñ–¥–ø–∏—Å–∫–∞ | billingPeriod = annual | 17% |

### –ü–ª–∞—Ç—ñ–∂–Ω—ñ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏

–î–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó —Ç–∞ –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å–∏—Å—Ç–µ–º–∞ –º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏ —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–π –ø–ª–∞—Ç—ñ–∂–Ω–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –Ω–∞ –æ—Å–Ω–æ–≤—ñ `region`, —è–∫–∏–π –±—É–≤ –æ–±—Ä–∞–Ω–∏–π –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.

| –†–µ–≥—ñ–æ–Ω | Provider |
| --- | --- |
| `UA` | Monobank |
| `BR` | PIX |
| All other regions | Stripe |

‚ö†Ô∏è –Ü–º–ø–ª–µ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –ø–æ–≤–Ω—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é —ñ–∑ —Å–µ—Ä–≤—ñ—Å–∞–º–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–∫—É —Å–µ—Ä–≤—ñ—Å-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

### User Flow

Register ‚Üí Login ‚Üí Calculate Price ‚Üí Subscribe

### –û—Å–Ω–æ–≤–Ω—ñ —Ç–æ—á–∫–∏ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è

- –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É
- –ö–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏
- –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å
- –Ø–∫—ñ—Å—Ç—å API
- –†–æ–±–æ—Ç–∞ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö

### –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ù–∞ –≤–∏—Ö–æ–¥—ñ –æ—á—ñ–∫—É—î—Ç—å—Å—è monolith mini-app –Ω–∞ **NestJS**, —è–∫–∏–π —Ä–µ–∞–ª—ñ–∑—É—î:

- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—é —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º —É –ë–î
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é
- Mock-—Å–µ—Ä–≤—ñ—Å–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –ø–ª–∞—Ç—ñ–∂–Ω–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü—ñ–Ω–∏ –∑ —Å–∏—Å—Ç–µ–º–æ—é –∑–Ω–∏–∂–æ–∫ (–ø—Ä–æ–º–æ–∫–æ–¥–∏ + —Ä—ñ—á–Ω–∞ –∑–Ω–∏–∂–∫–∞)
- –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ mock-–ø—Ä–æ–≤–∞–π–¥–µ—Ä –æ–ø–ª–∞—Ç–∏ –∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –¥–∞–Ω–∏—Ö
- CRUD –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- **Seed script** –∑ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –ø–ª–∞–Ω–∞–º–∏ —Ç–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- **Swagger UI** –Ω–∞ `/api/docs` (optional)
- Docker (optional)

---
## –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è
### 1. –ú—ñ–≥—Ä–∞—Ü—ñ—è legacy PostgreSQL —Å–∏—Å—Ç–µ–º–∏

–£ –≤–∞—Å —î legacy —Å–∏—Å—Ç–µ–º–∞ –∑ PostgreSQL –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö. –ë—ñ–∑–Ω–µ—Å –≤–∏—Ä—ñ—à–∏–≤ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–æ–≤—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –∑ –æ–Ω–æ–≤–ª–µ–Ω–æ—é —Å—Ö–µ–º–æ—é –¥–∞–Ω–∏—Ö.

**–í–∏–º–æ–≥–∏:**
- Zero downtime ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å rollback ‚Äî –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö ‚Äî –∂–æ–¥–Ω–∏—Ö –≤—Ç—Ä–∞—á–µ–Ω–∏—Ö –∞–±–æ –¥—É–±–ª—å–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö

**–û–ø–∏—à—ñ—Ç—å:**
- —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –º—ñ–≥—Ä–∞—Ü—ñ—ó,
- —è–∫ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö,
- —è–∫ –±—É–¥–µ—Ç–µ –≤–∞–ª—ñ–¥—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç,
- —è–∫—ñ rollback –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –ø–µ—Ä–µ–¥–±–∞—á–∏—Ç–µ.

---

### 2. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞ –ø–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä—É –∑ –æ–±–º–µ–∂–µ–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é

–ù–∞ —Å–∞–π—Ç—ñ —ñ—Å–Ω—É—é—Ç—å —Ç–æ–≤–∞—Ä–∏ –∑ –æ–±–º–µ–∂–µ–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é. –î–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –∫—É–ø–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ç–æ–≤–∞—Ä –Ω–∞ —Å–∫–ª–∞–¥—ñ. –û–±–∏–¥–≤–∞ –±–∞—á–∞—Ç—å ¬´1 —à—Ç. –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ¬ª —ñ –Ω–∞—Ç–∏—Å–∫–∞—é—Ç—å ¬´–û–ø–ª–∞—Ç–∏—Ç–∏¬ª.

**–û–ø–∏—à—ñ—Ç—å:**
- —è–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–Ω—É—Ç–∏,
- —è–∫ –±–∏ –≤–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–æ –≤–∏—Ä—ñ—à–∏–ª–∏ —Ü—é –∑–∞–¥–∞—á—É (–º—ñ–Ω—ñ–º—É–º 2 –ø—ñ–¥—Ö–æ–¥–∏).

---

### 3. –ë–∞–≥ —É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ñ –∑–Ω–∏–∂–æ–∫

–í–∏—è–≤–∏–ª–∏ –±–∞–≥ —É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ñ –∑–Ω–∏–∂–æ–∫, —è–∫–∏–π —ñ—Å–Ω—É–≤–∞–≤ 3 —Ç–∏–∂–Ω—ñ. –ó–∞ —Ü–µ–π —á–∞—Å 12,000 –∑–∞–º–æ–≤–ª–µ–Ω—å –æ—Ç—Ä–∏–º–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É –∑–Ω–∏–∂–∫—É:
- ~8,000 –ø–µ—Ä–µ–ø–ª–∞—Ç–∏–ª–∏ (–≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É $5),
- ~4,000 –Ω–µ–¥–æ–ø–ª–∞—Ç–∏–ª–∏ (–≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É $8).

**–û–ø–∏—à—ñ—Ç—å:**
- —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è affected –∑–∞–º–æ–≤–ª–µ–Ω—å,
- —è–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É–≤–∞—Ç–∏ refunds/charges –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ç–æ–≥–æ, —â–æ —á–∞—Å—Ç–∏–Ω–∞ –∫–∞—Ä—Ç–æ–∫ –≤–∂–µ expired,
- —è–∫ –∫–æ–º—É–Ω—ñ–∫—É–≤–∞—Ç–∏ –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏,
- —è–∫ –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –ø–æ–¥—ñ–±–Ω–æ–º—É –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É.

---

### 4. Multi-tenant SaaS e-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

–í–∏ –±—É–¥—É—î—Ç–µ e-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —è–∫ SaaS. –ö–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç (merchant) –º–∞—î —Å–≤—ñ–π –º–∞–≥–∞–∑–∏–Ω.  
–û—á—ñ–∫—É—î—Ç—å—Å—è:
- ~500 merchants,
- ~10,000 —Ç–æ–≤–∞—Ä—ñ–≤ —É –∫–æ–∂–Ω–æ–≥–æ,
- ~1,000 –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–∞ –¥–µ–Ω—å –Ω–∞ merchant.

–î–µ—è–∫—ñ merchants —Ö–æ—á—É—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É (—Å–≤–æ—ó —Ñ–æ—Ä–º—É–ª–∏ –∑–Ω–∏–∂–æ–∫, —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó).

**–û–ø–∏—à—ñ—Ç—å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É:**
- –æ–¥–Ω–∞ –ë–î —á–∏ database-per-tenant,
- —è–∫ —ñ–∑–æ–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ –º—ñ–∂ merchants,
- —è–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—é –±–µ–∑ —Ñ–æ—Ä–∫—ñ–≤ –∫–æ–¥—É,
- –¥–µ –º–µ–∂–∞ –º—ñ–∂ shared —ñ isolated –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏,
- —è–∫ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏, –∫–æ–ª–∏ –æ–¥–∏–Ω merchant –≤–∏—Ä–æ—Å—Ç–µ –≤ 100x.

---



## üá¨üáß Assignment Description (English)

### Context

You are building a backend for a SaaS platform that sells software subscriptions.  
The system must support user authentication, multiple pricing models, and a basic discount system.

### Technical Requirements

- NestJS
- PostgreSQL
- ORM (Prisma / TypeORM)
- REST architecture

### Business Requirements

| Plan | Base Price | Price per Seat | Included API calls |
| --- | --- | --- | --- |
| Starter | $29.99/month | ‚Äî | 1,000 |
| Professional | $99.49/month | $15.75/user | 10,000 |
| Enterprise | $299.90/month | $12.30/user | 100,000 |

### Discount System

| Discount Type | Condition | Value |
| --- | --- | --- |
| Promo code | Valid code | Fixed amount or percentage |
| Annual subscription | billingPeriod = annual | 17% |

### Payment Providers

To improve conversion and user experience, the system should automatically select a regional payment provider based on the `region` chosen during registration.

| Region | Provider |
| --- | --- |
| `UA` | Monobank |
| `BR` | PIX |
| All other regions | Stripe |

‚ö†Ô∏è Full integration with payment services is not required.  
Using mock service providers is sufficient.

### User Flow

Register ‚Üí Login ‚Üí Calculate Price ‚Üí Subscribe

### Evaluation Criteria

- Architecture and project structure
- Correctness of business logic
- Reliability
- API quality
- Database design

### Expected Outcome

The expected result is a monolithic mini-app built with **NestJS** that implements:

- User registration and authentication with database persistence
- Access control and authorization
- Mock services for different payment providers
- Pricing calculator with a discount system (promo codes + annual discount)
- Subscription creation via a mock payment provider with data persistence
- Read-only CRUD endpoints
- **Seed script** with test plans and promo codes
- **Swagger UI** available at `/api/docs` (optional)
- Docker support (optional)


---

## Theoretical Assignment

### 1. Legacy PostgreSQL Migration

You have a legacy system with a PostgreSQL database. The business has decided to migrate to a new architecture with an updated data schema.

**Requirements:**
- Zero downtime ‚Äî the system must remain fully operational
- Rollback capability ‚Äî ability to return to the previous state
- Data consistency ‚Äî no lost or duplicated data

**Describe:**
- the migration strategy,
- how data consistency is ensured,
- how the result is validated,
- which rollback mechanisms are planned.

---

### 2. Concurrent Purchase of Limited Inventory

The system has products with limited stock. Two users simultaneously attempt to purchase the last available item. Both see ‚Äú1 item in stock‚Äù and click ‚ÄúPay‚Äù.

**Describe:**
- what problems may occur,
- how you would solve this architecturally (at least two approaches).

---

### 3. Discount Calculator Bug

A bug in the discount calculator existed for 3 weeks. During this time, 12,000 orders received incorrect discounts:
- ~8,000 customers overpaid (average $5),
- ~4,000 customers underpaid (average $8).

**Describe:**
- the technical approach to identifying affected orders,
- how to automate refunds/charges considering that some cards have expired,
- how to communicate with customers,
- how to prevent similar issues in the future.

---

### 4. Multi-tenant SaaS E-commerce Platform

You are building an e-commerce platform as a SaaS. Each client (merchant) has their own store.  
Expected scale:
- ~500 merchants,
- ~10,000 products per merchant,
- ~1,000 orders per merchant per day.

Some merchants require custom business logic (custom discount formulas, integrations).

**Describe the architecture:**
- single database vs database-per-tenant,
- data isolation between merchants,
- how to implement customization without code forks,
- boundaries between shared and isolated components,
- how to scale when one merchant grows 100x.

---